<h2>Typescript. Начало работы.</h2>

<h2>Инициализация npm проекта.</h2>

<pre><code>npm init
</code></pre>

<h2>Установка транспилятора</h2>

<pre><code>sudo npm install -g typescript
</code></pre>

<h2>Установка и обновление nodejs и npm.</h2>

<pre><code>npm install npm@latest -g
sudo npm cache clean -f
sudo npm install -g n
sudo n stable
</code></pre>

<p>Проверка версии.</p>

<pre><code>node -v
</code></pre>

<h2>Создание конфигурационного файла.</h2>

<h2>Первая программа app.ts.</h2>

<pre><code>function greeter(person) {
    return "Hello, " + person;
}

greeter('Dima')
</code></pre>

<p>Компиляция.</p>

<pre><code>tsc app.ts
</code></pre>

<p>Либо указывая полный путь.</p>

<pre><code>./node_modules/.bin/tsc
</code></pre>

<p>Стартовая страница</p>

<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;&lt;title&gt;TypeScript Greeter&lt;/title&gt;&lt;/head&gt;
    &lt;body&gt;
        &lt;script src="app.js"&gt;&lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>Добавление веб сервера.</p>

<pre><code>npm install lite-server --save
</code></pre>

<p><em>Иногда возникает ошибка permission denied, mkdir '/home/user/.npm для устранения удалите папку .npm</em></p>

<h2>Запуск веб сервера.</h2>

<pre><code>./node_modules/.bin/lite-server
</code></pre>

<h2>Создание конфигурационного файла tsconfig.json</h2>

<p>В этом файле определяются:</p>

<ul>
<li><p>входная (корневая) директория проекта;</p></li>
<li><p>выходная директория;</p></li>
<li><p>опции компилятора;</p></li>
<li><p>определяются какие файлы включать и выключать из компиляции.</p>

<p>{
    "compilerOptions": {
        "emitDecoratorMetadata": true,
        "experimentalDecorators": true,
        "module": "commonjs",
        "target": "es2015",
        "outDir": "built",
        "rootDir": "src"
    }
}</p></li>
</ul>

<p><strong>если вы указываете файл для компиляции явно то конфигурационный файл игнорируется!</strong></p>

<p><a href="https://www.typescriptlang.org/docs/handbook/compiler-options.html">Список всех настроек typescript</a></p>

<p>Перенесем app.ts файл в папку src.</p>

<h3>Запуск транспилятора в режиме отслеживания изменений (watch).</h3>

<pre><code>tsc -w
</code></pre>

<h2>Исключение и включение каталогов из процесса слежения (tsconfig.json).</h2>

<pre><code>{
"compilerOptions": {
    ....
},
"include": [
    "**/*"
],
"exclude": [
    "node_modules",
    "**/*.spec.ts"
]}
</code></pre>

<p>При этом приняты следующие условные обозначения.</p>

<ul>
<li><ul>
<li>любое кол-во символов, исключая разделитель каталогов</li>
</ul></li>
</ul>

<p>? - один любой символ, исключая разделитель каталогов</p>

<p>**/ - все подкаталоги       </p>

<p>Полная версия</p>

<pre><code>{
    "compilerOptions": {
        "module": "commonjs",
        "esModuleInterop": true,
        "target": "es6",
        "noImplicitAny": false,
        "moduleResolution": "node",
        "sourceMap": true,
        "outDir": "dist",
        "baseUrl": ".",
        "paths": {
            "*": [
                "node_modules/*"
            ]
        }
    },
    "include": [
        "src/**/*"
    ],
    "exclude": [
        "node_modules"
    ]
}
</code></pre>

<h2>Определение типа передаваемого значения.</h2>

<pre><code>function greeter(person: string) {
</code></pre>

<h2>Попытка передать неверный тип.</h2>

<pre><code>let user = [0, 1, 2];
document.body.innerHTML = greeter(user);

src/app.ts:7:35 - error TS2345: Argument of type 'number[]' is not assignable to parameter of type 'string'.
</code></pre>

<h2>Определение типа возвращаемого значения.</h2>

<pre><code>function greeter(person: string): number {
    return "Hello, " + person;
}   
src/app.ts:8:1 - error TS2322: Type 'number' is not assignable to type 'string'.
</code></pre>

<h2>Модульность</h2>

<p>Определим библиотечную функцию src/lib/function.ts.</p>

<pre><code>export function sayHello( name ) {
    return `Hello {$name}`;
};
</code></pre>

<p>Импортируем ее в главном модуле app.js.</p>

<pre><code>import { sayHello } from './lib/function';

console.log(sayHello());
</code></pre>

<p>Получаем ошибку в консоле.    </p>

<pre><code>app.js:2 Uncaught ReferenceError: exports is not defined
</code></pre>

<p>Это значит что js не знает конструкцию exports и для этого необходимо использовать загрузчик модулей, например SystemJS.</p>

<p>Установка.</p>

<pre><code>npm install systemjs@0.19.22 --save
</code></pre>

<p>Шаблон</p>

<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;&lt;title&gt;TypeScript Greeter&lt;/title&gt;
        &lt;script src="node_modules/systemjs/dist/system.js"&gt;&lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;script&gt;
            SystemJS.config({
                defaultJSExtensions: true
            });
            SystemJS.import('built/index.js');        
        &lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>При компиляции на лету (внутри браузера без запуска tsc).</p>

<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;&lt;title&gt;TypeScript Greeter&lt;/title&gt;
        &lt;script src="node_modules/systemjs/dist/system.js"&gt;&lt;/script&gt;
        &lt;script src="node_modules/typescript/lib/typescript.js"&gt;&lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;script&gt;
            SystemJS.config({
                transpiler: 'typescript',
                    packages: {
                    src: {
                          defaultExtension: 'ts'
                        }
                    }
            });
            SystemJS.import('src/index.ts');      

        &lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>
