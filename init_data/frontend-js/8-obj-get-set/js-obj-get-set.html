<h2>Дескрипторы свойств.</h2>

<p>Мы рассмотрим возможности, которые позволяют очень гибко и мощно управлять всеми свойствами объекта, включая их аспекты – изменяемость, видимость в цикле for..in и даже незаметно делать их функциями.</p>

<p>Основной метод для управления свойствами – <strong>Object.defineProperty</strong>.</p>

<p>Он позволяет объявить свойство объекта и, что самое главное, тонко настроить его особые аспекты, которые никак иначе не изменить.</p>

<p>Синтаксис:</p>

<pre><code>Object.defineProperty(obj, prop, descriptor)
</code></pre>

<p><strong>obj</strong> - Объект, в котором объявляется свойство.</p>

<p><strong>prop</strong> - Имя свойства, которое нужно объявить или модифицировать.</p>

<p><strong>descriptor</strong> - Дескриптор – объект, который описывает поведение свойства.</p>

<p>В нём могут быть следующие поля:</p>

<p><strong>value</strong> – значение свойства, по умолчанию undefined</p>

<p><strong>writable</strong> – значение свойства можно менять, если true. По умолчанию false.</p>

<p><strong>configurable</strong> – если true, то свойство можно удалять, а также менять его в дальнейшем при помощи новых вызовов defineProperty. По умолчанию false.</p>

<p><strong>enumerable</strong> – если true, то свойство просматривается в цикле for..in и методе Object.keys(). По умолчанию false.</p>

<p><strong>get</strong> – функция, которая возвращает значение свойства. По умолчанию undefined.</p>

<p><strong>set</strong> – функция, которая записывает значение свойства. По умолчанию undefined.</p>

<p>Чтобы избежать конфликта, запрещено одновременно указывать значение value и функции get/set.</p>

<h2>Обычное свойство</h2>

<pre><code>var user = {};

// 1. простое присваивание
user.name = "Вася";

// 2. указание значения через дескриптор
Object.defineProperty(user, "name", { value: "Вася", configurable: true, writable: true, enumerable: true });
</code></pre>

<p>Для того, чтобы сделать свойство неизменяемым, изменим его флаги writable и configurable:</p>

<pre><code>"use strict";

var user = {};

Object.defineProperty(user, "name", {
  value: "Вася",
  writable: false, // запретить присвоение "user.name="
  configurable: false // запретить удаление "delete user.name"
});

// Теперь попытаемся изменить это свойство.

// в strict mode присвоение "user.name=" вызовет ошибку
user.name = "Петя";
</code></pre>

<p>Свойство-функция
Дескриптор позволяет задать свойство, которое на самом деле работает как функция. Для этого в нём нужно указать эту функцию в get.</p>

<pre><code>var user = {
  firstName: "Вася",
  surname: "Петров"
}

Object.defineProperty(user, "fullName", {
  get: function() {
    return this.firstName + ' ' + this.surname;
  }
});

alert(user.fullName); // Вася Петров
</code></pre>

<p>Также можно указать функцию, которая используется для записи значения, при помощи дескриптора set.</p>

<pre><code>var user = {
  firstName: "Вася",
  surname: "Петров"
}

Object.defineProperty(user, "fullName", {

  get: function() {
    return this.firstName + ' ' + this.surname;
  },

  set: function(value) {
      var split = value.split(' ');
      this.firstName = split[0];
      this.surname = split[1];
    }
});

user.fullName = "Петя Иванов";
alert( user.firstName ); // Петя
alert( user.surname ); // Иванов
</code></pre>

<h2>Указание get/set в литералах</h2>

<p>Если мы создаём объект при помощи синтаксиса { ... }, то задать свойства-функции можно прямо в его определении.</p>

<p>Для этого используется особый синтаксис: get свойство или set свойство.</p>

<pre><code>var user = {
  firstName: "Вася",
  surname: "Петров",

  get fullName() {
    return this.firstName + ' ' + this.surname;
  },

  set fullName(value) {
    var split = value.split(' ');
    this.firstName = split[0];
    this.surname = split[1];
  }
};

alert( user.fullName ); // Вася Петров (из геттера)

user.fullName = "Петя Иванов";
alert( user.firstName ); // Петя  (поставил сеттер)
alert( user.surname ); // Иванов (поставил сеттер)
</code></pre>
