<h1>Аркадная игра.</h1>

<p><img src="https://webmonstr.com/media/course/frontend-js/12-animate/images/1.png" alt="start page" /></p>

<p><a href="https://github.com/zdimon/simple-arcade">ссылка на репозиторий</a></p>

<h2>Передвижение объекта по горизонтали.</h2>

<p>Задача: перемещать внутренний блок относительного внешнего по горизонтали бесконечно взад-вперед.</p>

<h2>Решение.</h2>

<p>Определим 2 блока на странице.</p>

<pre><code>&lt;div class="out"&gt;
  &lt;div class="in" id="ball"&gt;

  &lt;/div&gt;
&lt;/div&gt;
</code></pre>

<p>Стили.</p>

<pre><code>.out {
    width: 200px;
    height: 200px;
    position: relative;
    border: 1px solid silver;
}

.in {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    background-color: red;
    position: absolute;
}
</code></pre>

<p>Определим бесконечный таймер.</p>

<pre><code>var timerFunc = function() {
    console.log($.now());
    id = setTimeout(timerFunc, 1000);
}

var id = setTimeout(timerFunc, 1000);
</code></pre>

<p>Определим объект шарика с элементом и направление движения.</p>

<pre><code>$( document ).ready(() =&gt; {


    var ball = {
        el: $('#ball'),
        move: 'right'
    };

    var timerFunc = function() {
        id = setTimeout(timerFunc, 1000);
        ball.el.css({'left' : parseInt(ball.el.position().left+5) + 'px'});
    }

    var id = setTimeout(timerFunc, 1000);

    }
);
</code></pre>

<p>Отработаем два направления движения.</p>

<pre><code>var timerFunc = function() {
    id = setTimeout(timerFunc, 100);
    if(ball.move === 'right') {
        var newCoord =  parseInt(ball.el.position().left+5);
    } else {
        var newCoord =  parseInt(ball.el.position().left-5);
    }
    ball.el.css({'left' : newCoord + 'px'});

    if (newCoord&gt;200) {
        ball.move = 'left';
    } 

    if (newCoord&lt;0) {
        ball.move = 'right'
    }
}
</code></pre>

<p>Проблема возникнет когда у нас будет много объектов, при таком подходе мы будем вынуждены для каждого устанавливать свой таймер и когда их станет много это будет очень неудобно.</p>

<p>Поэтому логичней определить специальную функцию - жизненный цикл, которую запустить с интервалом и в ней передвигать все объекты на странице.</p>

<pre><code>$( document ).ready(() =&gt; {

    var ball2 = {
        el: $('#ball2'),
        move: 'right'
    };


    function gameLoop()
    {
        console.log(parseInt($.now()));
        setTimeout(gameLoop,100);
    }

    gameLoop();
}

);
</code></pre>

<p>Создадим для игры один единственный блок.</p>

<pre><code>&lt;div class="out" id="gameApp"&gt; &lt;/div&gt;
</code></pre>

<p>Далее создадим 3 функции:</p>

<p>clear - для очистки игрового поля</p>

<p>draw - для прорисовки всех элементов</p>

<p>calc - для пересчета координат элементов</p>

<p>И вызовем их в жизненном цикле событий.</p>

<pre><code>function clear() {

}

function calc() {

}

function draw() {

}

function gameLoop()
{
    // change position based on speed
    //moveSelection();
    console.log(parseInt($.now()));
    calc();
    clear();
    draw();
    setTimeout(gameLoop,100);
}
</code></pre>

<p>Далее закинем все объекты игры в один объект.</p>

<pre><code>var gameApp = {
    balls: [
        {x: 0, y: 30},
        {x: 30, y: 100},
    ]
}
</code></pre>

<p>Опишем функцию очистки.</p>

<pre><code>function clear() {
    $("#game").clear();
}
</code></pre>

<p>Функция прорисовки.</p>

<pre><code>function draw() {
    for (let ball of gameApp.balls) {
        $('#gameApp').append(`&lt;div class="ball" style="top:${ball.y}px; left:${ball.x}px"&gt;`);
    }
}
</code></pre>

<p>Функция пересчета координат объектов.</p>

<pre><code>function calc() {
    for (let ball of gameApp.balls) {
        if(ball.x&gt;170) ball.move = 'left';
        if (ball.x&lt;30) ball.move = 'right';

        if(ball.move === 'left') ball.x = ball.x - 4;
        if(ball.move === 'right') ball.x = ball.x + 4;
    }        
}
</code></pre>

<p>Двигаем объект пушки по нажатию стрелок.</p>

<p>Добавим стили для пушки.</p>

<pre><code>.canon {
    height: 25px;
    width: 5px;
    background-color: black;
    position: absolute;
}
</code></pre>

<p>Добавим координату пушки и статус нажатия клавиш стрелок в объект игры.</p>

<pre><code>var gameApp = {
    balls: [
        {x: 0, y: 30, move: 'right'},
        {x: 70, y: 100, move: 'left'},
    ],
    cannon_x: 100,
    key_left: 'up',
    key_right: 'up'
}
</code></pre>

<p>Добавим в прорисовку.</p>

<pre><code>function draw() {
    for (let ball of gameApp.balls) {
        $('#gameApp').append(`&lt;div class="ball" style="top:${ball.y}px; left:${ball.x}px"&gt;`);
    }
    $('#gameApp').append(`&lt;div class="canon" style="top:170px; left:${gameApp.cannon_x}px"&gt;`);
}
</code></pre>

<p>Отслеживаем нажатие кнопок стрелок.</p>

<pre><code>$(document).on('keyup', function( e ) {

    if(e.keyCode === 39) gameApp.key_right = 'up'
    if(e.keyCode === 37) gameApp.key_left = 'up'

})

$(document).on('keydown', function( e ) {

    if(e.keyCode === 39) gameApp.key_right = 'down'
    if(e.keyCode === 37) gameApp.key_left = 'down'

})
</code></pre>

<p>Добавляем пересчет координат пушки.</p>

<pre><code>function calc() {
    for (let ball of gameApp.balls) {
        if(ball.x&gt;170) ball.move = 'left';
        if (ball.x&lt;0) ball.move = 'right';

        if(ball.move === 'left') ball.x = ball.x - 4;
        if(ball.move === 'right') ball.x = ball.x + 4;

    }      
    if(gameApp.key_left === 'down') gameApp.cannon_x = gameApp.cannon_x - 4;
    if(gameApp.key_right === 'down') gameApp.cannon_x = gameApp.cannon_x + 4;

}
</code></pre>

<p>Делаем ограничение движения пушки по размерам экрана.</p>

<pre><code>    if(gameApp.key_left === 'down') (gameApp.cannon_x&gt;0)? gameApp.cannon_x = gameApp.cannon_x - 4: gameApp.cannon_x = 0;
    if(gameApp.key_right === 'down') (gameApp.cannon_x&lt;190)? gameApp.cannon_x = gameApp.cannon_x + 4: gameApp.cannon_x=190;
</code></pre>

<p>Добавим пульки в объект игры.</p>

<pre><code>var gameApp = {
    ....
    bullets: []
}
</code></pre>

<p>Отработаем нажатие на пробел.</p>

<pre><code>$(document).on('keydown', (e) =&gt; {
    ...
    if(e.keyCode === 32) {
        gameApp.bullets.push({x: gameApp.canon_x, y: 185})
    }
   ...
})
</code></pre>

<p>Изменяем координаты пуль и убираем их из массива при выходе за пределы игрового поля.</p>

<pre><code>    for (let bullet of gameApp.bullets){

        bullet.y -= 2;
        if(bullet.y&lt;0) gameApp.bullets.splice(gameApp.bullets.indexOf(bullet),1);

       }
</code></pre>

<h2>Пример определения коллизии.</h2>

<pre><code>var rect1 = {x: 5, y: 5, width: 50, height: 50}
var rect2 = {x: 20, y: 10, width: 10, height: 10}

if (rect1.x &lt; rect2.x + rect2.width &amp;&amp;
   rect1.x + rect1.width &gt; rect2.x &amp;&amp;
   rect1.y &lt; rect2.y + rect2.height &amp;&amp;
   rect1.y + rect1.height &gt; rect2.y) {
    // collision detected!
}
</code></pre>
