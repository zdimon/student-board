<h1>Первичная настройка сервера. Работа с сервером по протоколу ssh.</h1>

<h2>Генерация ключей.</h2>

<pre><code>ssh-keygen
</code></pre>

<h2>Вывод ключа в терминале</h2>

<pre><code>cat ~/.ssh/id_rsa.pub
</code></pre>

<p><img src="https://webmonstr.com/media/course/linux/11-server-setup/images/2.png" alt="start page" /></p>

<h2>Команда копирования публичного ключа.</h2>

<pre><code>ssh-copy-id root@servaername.com
</code></pre>

<h2>Соддание алиаса для быстрой команды подключения.</h2>

<p>В файле .bash_aliases домашней директории прописываем.</p>

<pre><code>alias putin='ssh root@tity.webmonstr.com'
</code></pre>

<h2>Команда соединения с сервером</h2>

<pre><code>ssh username@host
ssh root@mydomain.com
ssh root@234.12.5.67
</code></pre>

<h2>Обновление репозитория.</h2>

<pre><code>sudo apt update
</code></pre>

<p>Далее установим </p>

<pre><code>sudo apt install software-properties-common
</code></pre>

<p>Эта библиотека предоставляет инструменты для управления репозиторием apt (добавление и удалением источников приложений) через команды, иначе пришлось бы редактировть файл /etc/apt/sources.list.d руками.</p>

<h2>Проблема с локалью.</h2>

<p><img src="https://webmonstr.com/media/course/linux/11-server-setup/images/3.png" alt="start page" /></p>

<p>Проверяем локаль.</p>

<pre><code>locale -a
</code></pre>

<p>Locale – это локализация Linux которая определяет в какой кодировке пользователь видит всё в терминале.</p>

<p>Установим редактор nano</p>

<pre><code>apt install nano
</code></pre>

<p>Откроем для редактирования файлик /etc/locale.gen</p>

<pre><code>nano /etc/locale.gen
</code></pre>

<p>Поищем через ctrl+W en_US</p>

<p>Раскомментируем строку</p>

<pre><code>en_US.UTF-8 UTF-8
uk_UA.UTF-8 UTF-8
</code></pre>

<p>И сохраним через ctr+O и Enter и ctrl+x - выходим.</p>

<p>Осталось сгенерировать локаль</p>

<pre><code>sudo locale-gen
</code></pre>

<p><img src="https://webmonstr.com/media/course/linux/11-server-setup/images/4.png" alt="start page" /></p>

<p>Проверим теперь.</p>

<p><img src="https://webmonstr.com/media/course/linux/11-server-setup/images/5.png" alt="start page" /></p>

<h2>Добавление пользователя.</h2>

<p>sudo adduser webmaster</p>

<h2>Переход на произвольного пользователя</h2>

<pre><code>su webmaster
</code></pre>

<h2>Включение пользователя в группу sudo</h2>

<p>Провверить какие пользователи имеют право запускать команды через sudo можно командой.</p>

<pre><code>sudo whoami
</code></pre>

<p>В файле /etc/sudoers содержаться пользователи и группы, которые это могут.</p>

<p>Включить пользователя в sudoers.</p>

<pre><code>sudo adduser &lt;username&gt; sudo

sudo usermod -a -G sudo &lt;username&gt;
</code></pre>

<p>Сделать безпарольный запуск.</p>

<pre><code>username  ALL=(ALL) NOPASSWD:ALL

%sudo   ALL=(ALL:ALL) NOPASSWD: ALL
</code></pre>

<h2>Установка Python.</h2>

<pre><code>sudo apt install python2 python3 -y
</code></pre>

<p>y - автоматическое согласие на вопросы при установке</p>

<p>Когда мы имеем дело с несколькими версиями одной комманды, например</p>

<pre><code>python
python2
python3
</code></pre>

<p>Посмотреть где находятся бинарники.</p>

<pre><code> which python2
 which python3
</code></pre>

<p>Удобно пользоваться инструментом  update-alternatives для управления переключением использования версии по умолчанию.</p>

<h2>Установим питон по старше из репозитория "мертвых змей".</h2>

<pre><code>sudo add-apt-repository ppa:deadsnakes/ppa
</code></pre>

<p>Официальные репозитории Ubuntu хоть и содержат огромное количество пакетов, труднодоступных для обычных разработчиков, в них сложно поддерживать актуальные версии своей программы, да и вообще, не каждый проект имеет шанс туда попасть. Для создания собственного репозитория необходимы ресурсы, как минимум, сервер, и неплохие навыки администратора. Всё это создаёт некоторые препятствия для распространения программ для Ubuntu.</p>

<p>(Personal Package Arhive - PPA) - сервис для обычного пользователя который дает возможность любому создать свой репозиторий. </p>

<p>Обновляем, ставим.</p>

<pre><code>apt update
apt install python3.7
</code></pre>

<p>Добавляем альтернативы.</p>

<pre><code>sudo update-alternatives --install /usr/bin/python python /usr/bin/python3.5 1
sudo update-alternatives --install /usr/bin/python python /usr/bin/python3.7 2
</code></pre>

<p>Выбираем</p>

<pre><code>sudo update-alternatives --config python
</code></pre>

<p><img src="https://webmonstr.com/media/course/linux/11-server-setup/images/7.png" alt="start page" /></p>

<h2>Создание виртуального окружения.</h2>

<p>Установка</p>

<pre><code>apt install python3.7-venv python3.7-dev
</code></pre>

<p>Создание </p>

<pre><code>python3 -m venv venv
</code></pre>

<p>Активация </p>

<pre><code>. ./venv/bin/activate
</code></pre>

<p>Установка библиотек.</p>

<pre><code>pip install django
pip install pytelegrambotapi
</code></pre>

<h2>Создание и запуск проекта Django в скрине</h2>

<p>Устанавливаем скрины</p>

<pre><code>apt install screen
</code></pre>

<p>Создаем скрин</p>

<pre><code>screen -S dj
</code></pre>

<p>Создаем проект и запускаем сервер</p>

<pre><code>django-admin startproject prj
cd prj
./manage.py migrate
./manage.py createsuperuser
./manage.py runserver 0.0.0.0:8080
</code></pre>

<p>Отключаемся от скрина по ctrl+A потом D</p>

<p>Вывод запущенных скринов.</p>

<pre><code>screel -ls
</code></pre>

<p>Подключение к скрину</p>

<pre><code>screen -r &lt;id или name&gt;
</code></pre>

<p>К чужому скрину в многопользовательском режиме</p>

<pre><code>screen -x &lt;id или name&gt;
</code></pre>

<p>Установка дополнительного ПО</p>

<pre><code>apt install htop mc git wget nginx
</code></pre>

<h2>Запуск команд удаленно</h2>

<pre><code>ssh root@tiny.webmonstr.com 'ls'
</code></pre>
