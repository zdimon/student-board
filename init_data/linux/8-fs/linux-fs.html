<h1>Файловая система</h1>

<h2>Структура диска.</h2>

<p>Жесткий диск, флешка, ssd это все имеет блочную органицацию данных.</p>

<p>LBA (англ. Logical block addressing) — стандартизованный механизм адресации и доступа к блоку данных.</p>

<p>При котором системному контроллеру нет необходимости учитывать специфику накопителя (например, геометрию жёсткого диска — количество цилиндров, головок, секторов на дорожке).</p>

<p>Жесткий диск не умеет адресовать свое пространство побайтно, условно оно разбито на блоки. </p>

<p>В LBA каждому адресуемому блоку назначается уникальный номер — целое число, начиная с нуля.</p>

<p>Размер блока в обычных дисках = 512 байт</p>

<p><img src="https://webmonstr.com/media/course/linux/8-fs/images/1.png" alt="start page" /></p>

<p>Как видно из рисунка, блоки LBA обозначен как уровень HDD.</p>

<p>Просмотреть размер блока.</p>

<pre><code>sudo blockdev --getpbsz /dev/sdb
</code></pre>

<p>Уровнем выше размечен раздел, один на весь диск (для простоты). </p>

<p>Чаще всего используют разметку разделов двух типов: msdos и gpt. Соответственно msdos — старый формат, поддерживающий диски до 2Tb, gpt — новый формат, способный адресовать до 1 зеттабайта 512 байтных блоков. В нашем случае имеем раздел типа msdos, как видно из рисунка, раздел при этом начинается с блока №1, нулевой же используется для MBR.</p>

<p>sudo tune2fs -l /dev/sdb6</p>

<p>В первом разделе создана файловая система ext4</p>

<p>Посмотреть размер блока файловой системы можно так:</p>

<pre><code>tune2fs -l /dev/sdb6
</code></pre>

<p><img src="https://webmonstr.com/media/course/linux/8-fs/images/2.png" alt="start page" /></p>

<p>Файл состоит из одного или нескольких блоков файловой системы, в которых хранятся его данные. Зная имя файла, как его найти? Какие блоки читать?</p>

<p>Вот тут нам и пригождаются inode. В файловой системе ext2fs есть «таблица», в которой содержится информация по всем inode. Количество inode в случае с ext2fs задается при создании файловой системы. </p>

<p>В inode содержится нужная нам информация: список блоков файловой системы для искомого файла. Как найти номер inode для указанного файла?</p>

<p>Соответствие имени и номера inode содержится в директории, а директория в ext2fs — это файл особого типа, т.е. тоже имеет свой номер inode. Чтоб разорвать этот порочный круг, для корневой директории назначили «фиксированный» номер inode «2».</p>

<p>Смотрим содержимое inode за номером 2:</p>

<pre><code>sudo debugfs /dev/sdb6
debugfs:  stat &lt;2&gt;
</code></pre>

<p><img src="https://webmonstr.com/media/course/linux/8-fs/images/3.png" alt="start page" /></p>

<p>Как видно нужная нам директория сидит в блоке под номером 9293.</p>

<p>В ней мы найдем номер нода для папки home, и так далее по цепочке, пока не увидим номер нода для запрошенного файла.</p>
